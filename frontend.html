<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kaffee</title>
    <style>* {
    position: relative;
    margin-left: 50%;
    transform: translate(-50%);
}
h1{
    font-size: 40px;
    width: 350px;
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
}

.power-btn{
    background-color: antiquewhite;
}

.power-btn.on{
    background-color:chartreuse;
}

.invisible{
    visibility: hidden;
}

.left {
    float: left;
}

.clear {
    clear: both;
}

.filler {
    float: right;
    margin-top: -35px;
}

.fill-stand{
    width: 200px;
}

.disabled{
    background-color: red;
}</style>
<body>
    <p id="balance-display">Balance: CHF <span id="balance">10</span></p>
    <h1>Kaffee Maschine</h1>
    <div id="display">Display: </div>
    <br>
    <form>
        <select id="select-coffee">
          <option value="black" selected="selected">Schwarz</option>
          <option value="espresso" >Espresso</option>
          <option value="mokka">Mokka</option>
          <option value="cappuccino">Cappuccino</option>
          <option value="latte_macciato">Latte Macciato</option>
          <option value="milk">Milch</option>
        </select>
        <label for="amount-ml">Menge (ml):</label>
        <input type="number" id="amount-ml" min="50" max="500" step="50" value="250">
      </form>
  
      <!-- Payment Button -->
      <button id="pay">Bezahlen</button>
    <script src="service.js"></script>
<script>/**
 * Disable Chrome security
 * google-chrome --disable-web-security --allow-file-access-from-files --user-data-dir="/home/yanick/Desktop/chrome"
 */

var xhttp = new XMLHttpRequest();


const backendBaseUrl = "http://localhost:8080/engine-rest"
let backendId = ""
let activityName = ""
let userBalance = 10; // Hardcoded user balance
const coffeeCost = 2; // Cost per coffee

// http://localhost:8080/engine-rest/process-instance/cd6a7fd6-3bde-11ec-b651-0242ac110002/activity-instances
// http://localhost:8080/engine-rest/task

const coffeeSortSelect = document.querySelector('#coffee-sort');
const amountInput = document.querySelector('#amount-ml');
const payButton = document.querySelector('#pay');

getProcessInstanceId();

payButton.addEventListener("click", () => {
    if (userBalance >= coffeeCost) {
        orderCoffee(coffeeSortSelect.value, amountInput.value);
    } else {
        displayMessage("Nicht genug Guthaben f√ºr Kaffee"); 
    }
});

function getProcessInstanceId() {
    xhttp.onreadystatechange = function () {
        if (this.readyState === 4 && this.status === 200) {
            backendId = JSON.parse(this.responseText)[0].id;
        }
    };
    xhttp.open("GET", `${backendBaseUrl}/process-instance`, true);
    xhttp.send();
}

function orderCoffee(coffeeType, amount) {
    xhttp.onreadystatechange = function () {
        if (this.readyState === 4 && this.status === 204) {
            userBalance -= coffeeCost;
            displayMessage("Kaffee wird zubereitet");         
        }
    };
    xhttp.open("POST", `${backendBaseUrl}/message`, true);
    xhttp.setRequestHeader("Accept", "application/json");
    xhttp.setRequestHeader("Content-Type", "application/json");
    xhttp.send(JSON.stringify({
        messageName: "order_coffee",
        processVariables: {
            coffeeType: { type: "string", value: coffeeType },
            amount: { type: "integer", value: amount }
        }
    }));
}

function displayMessage(message) {
    display.innerText = message; // Update the display element with the message
}

const balanceDisplay = document.querySelector('#balance');

function updateBalanceDisplay() {
    balanceDisplay.innerText = userBalance.toFixed(2); // Update the balance display
}

</script></body>
</html>